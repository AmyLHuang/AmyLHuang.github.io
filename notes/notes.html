<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="notes.css">
    <link rel="icon" href="../static/images/favicon.png">
    <title>Notes</title>
</head>
<body>
    <!-- Top bar with tabs + mode toggle -->
    <div id="topbar">
        <div id="tabs">
            <div class="active" onclick="loadNotes('data', this)">Data</div>
            <div onclick="loadNotes('bi', this)">BI</div>
            <div onclick="loadNotes('python', this)">Python</div>
            <div onclick="loadNotes('ai', this)">AI</div>
            <div onclick="loadNotes('stats', this)">Stats</div>
            <div onclick="loadNotes('coop', this)">COOP</div>
            <div onclick="loadNotes('projects', this)">Projects</div>
            <div onclick="loadNotes('other', this)">Other</div>
        </div>
        <button id="mode-toggle" onclick="toggleMode()">‚òÄÔ∏è</button>
    </div>

    <!-- Main layout -->
    <div id="main">
        <div id="toc"></div>
        <div id="notes-container">
            <button id="print-btn" onclick="openPrintableNotes()">üñ®Ô∏è Print Preview</button>
            <div id="notes"></div>
        </div>
    </div>

    <script>
        async function loadNotes(section, tabElement) {
            try {
                const res = await fetch(`topics/${section}.html`);
                const html = await res.text();
                document.getElementById('notes').innerHTML = html;
                generateTOC();

                // highlight active tab
                document.querySelectorAll('#tabs div').forEach(tab => tab.classList.remove('active'));
                tabElement.classList.add('active');
            } catch (err) {
                document.getElementById('notes').innerHTML = "<p>Error loading notes.</p>";
            }
        }

        function generateTOC() {
            const notes = document.getElementById('notes');
            const headers = notes.querySelectorAll('h2, h3');
            let tocHTML = "<h3>Table of Contents</h3><ul>";
            headers.forEach((header, i) => {
                const id = "header-" + i;
                header.id = id;
                tocHTML += `<li><a href="#${id}">${header.innerText}</a></li>`;
            });
            tocHTML += "</ul>";
            document.getElementById('toc').innerHTML = tocHTML;
        }

        function openPrintableNotes() {
            const section = document.getElementById('notes');
            if (!section) return alert("Couldn't find notes section.");

            const printWindow = window.open('print.html', '_blank');
            const html = section.innerHTML;

            // Wait for the new window to load, then send data
            window.addEventListener('message', function handler(e) {
                if (e.data === 'ready-for-content') {
                    printWindow.postMessage({ type: 'loadNotes', html }, '*');
                    window.removeEventListener('message', handler);
                }
            });
        }

        // Dark and light mode
        const modeButtons = document.querySelectorAll(".mode-toggle");

        const savedTheme = localStorage.getItem("theme");
        if (savedTheme === "dark") {
            document.body.classList.add("dark");
        } else {
            document.body.classList.remove("dark");
        }

        const initialIcon = document.body.classList.contains("dark") ? "üåô" : "‚òÄÔ∏è";
        modeButtons.forEach(btn => btn.textContent = initialIcon);

        function toggleMode() {
            document.body.classList.toggle("dark");

            // Update icon
            const icon = document.body.classList.contains("dark") ? "üåô" : "‚òÄÔ∏è";
            modeButtons.forEach(btn => btn.textContent = icon);

            // Save preference
            if (document.body.classList.contains("dark")) {
                localStorage.setItem("theme", "dark");
            } else {
                localStorage.setItem("theme", "light");
            }
        }

            modeButtons.forEach(btn => btn.addEventListener("click", toggleMode));

        // Load default (AI) on page load
        window.onload = () => loadNotes('data', document.querySelector('#tabs div'));
    </script>
</body>

</html>